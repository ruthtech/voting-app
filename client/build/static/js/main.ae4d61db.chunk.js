(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{16:function(e,t,a){},39:function(e,t,a){e.exports=a.p+"static/media/canada-flag.dea429e4.svg"},45:function(e,t,a){e.exports=a(77)},50:function(e,t,a){},77:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(26),o=a.n(c),i=(a(50),a(7)),l=a(13),s=a.n(l),u=a(6),d=a(40),m=a(8),f=a(12),v=a.n(f),p=r.a.createContext(),E=a(39),b=a.n(E);a(16);var g=function(e){var t=Object(n.useState)(),a=Object(i.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(),f=Object(i.a)(l,2),E=f[0],g=f[1];return r.a.createElement(p.Consumer,null,(function(t){var a=t.handleLogin;return r.a.createElement("div",{className:"container-fluid bg-almostWhite full-screen"},r.a.createElement("div",{className:"row flag-block "},r.a.createElement(d.a,{className:"bg-white",src:b.a,alt:"Canada Flag"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col heading"},r.a.createElement("h1",null,"Canada Votes Online"))),r.a.createElement("div",{className:"row bottom-page"},r.a.createElement("div",{className:"col"},r.a.createElement(m.a,null,r.a.createElement(m.a.Group,{id:"formBasicUUID"},r.a.createElement(m.a.Label,{className:"entry-field-label"},"Username"),r.a.createElement(m.a.Control,{type:"text",defaultValue:c,onChange:function(e){return o(e.target.value)}})),r.a.createElement(m.a.Group,{id:"formBasicPassword"},r.a.createElement(m.a.Label,{className:"entry-field-label"},"Password"),r.a.createElement(m.a.Control,{type:"password",defaultValue:E,onChange:function(e){return g(e.target.value)}})),r.a.createElement("div",{className:"right-align-div"},r.a.createElement(u.a,{variant:"secondary",type:"submit",onClick:function(t){!function(t,a,n,r){var c;s.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,r.preventDefault(),"admin"!==(t=encodeURI(t))){o.next=6;break}return n({name:"admin",isAdmin:!0}),o.abrupt("return");case 6:return"/api/v1/login",o.next=9,s.a.awrap(v()({method:"post",url:"/api/v1/login",data:{username:t,password:a}}));case 9:if((c=o.sent).data.isVerified){o.next=14;break}return e.log.error("No user found with username ".concat(t," and that password.")),n(null),o.abrupt("return");case 14:n(c.data.isVerified),o.next=22;break;case 17:o.prev=17,o.t0=o.catch(0),e.log.error("Error while retrieving username ".concat(t," and that password.")),e.log.error(o.t0),n(null);case 22:case"end":return o.stop()}}),null,null,[[0,17]])}(c,E,a,t)}},"Sign in"))))))}))},h=a(18),y=a(19),w=a(21),N=a(20),C=a(22),k=(a(38),a(23)),j=a.n(k),O=a(11),S=a(10),I=a(42);var x=function(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),c=a[0],o=a[1],l=function(t){return e.log.debug("EditDistrictConfirm render default location is ",e.location),r.a.createElement("div",{className:"container-fluid bg-almostWhite full-screen"},r.a.createElement("div",{className:"row pt-3"},r.a.createElement("div",{className:"col"},r.a.createElement("h4",null,"Is this correct?"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h6",null,"If there were any problems locating the address that you entered, the closest address is displayed below."))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col bg-white centre-align-div"},r.a.createElement("p",null,e.location.street.number," ",e.location.street.name,", ",e.location.city,", ",e.location.state,", ",e.location.postcode))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",type:"button",onClick:function(){o(1)}},"Edit")),r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",type:"submit",onClick:function(){!function(t){var a,n,r,c,o,i,l;s.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,a=encodeURI(e.username),n=encodeURI(e.location.street.number),r=encodeURI(e.location.street.name),c=encodeURI(e.location.city),o=encodeURI(e.location.state),i=encodeURI(e.location.postcode.replace(/\s/g,"")),u.next=9,s.a.awrap(v()({method:"put",url:"/api/v1/voters/"+a,data:{streetNo:n,streetName:r,city:c,province:o,postcode:i}}));case 9:l=u.sent,e.log.debug("EditDistrictConfirm, newUser.data ",l.data),t(l.data),e.log.debug("EditDistrictConfirm after handleLogin"),u.next=18;break;case 15:u.prev=15,u.t0=u.catch(0),e.log.error(u.t0);case 18:case"end":return u.stop()}}),null,null,[[0,15]])}(t),o(2)}},"Confirm"))))},d=function(t){switch(c){case 1:return r.a.createElement(B,{location:e.location});case 2:return r.a.createElement(H,null);case 0:default:return l(t)}};return r.a.createElement(p.Consumer,null,(function(e){var t=e.handleLogin;return d(t)}))},L=a(17),D=a.n(L),P=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(w.a)(this,Object(N.a)(t).call(this,e))).handleFormSubmit=function(e){var t,n,r,c,o,i,l;return s.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,e.preventDefault(),t=a.context.log,n=encodeURI(a.state.location.street.number),r=encodeURI(a.state.location.street.name),c=encodeURI(a.state.location.city),o=encodeURI(a.state.location.state),i=encodeURI(a.state.location.postcode.replace(/\s/g,"")),t.debug("EditDistrict about to call /api/v1/verifyAddress/".concat(n,"/").concat(r,"/").concat(c,"/").concat(o,"/").concat(i)),u.next=11,s.a.awrap(v()({method:"post",url:"/api/v1/verifyAddress",data:{streetNo:n,streetName:r,city:c,province:o,postcode:i}}));case 11:l=u.sent,t.debug("EditDistrict, newLocation is ",l.data),a.setState({location:l.data}),t.debug("EditDistrict, after new location state is ",a.state.location),a.setState({activeComponentId:1}),u.next=22;break;case 19:u.prev=19,u.t0=u.catch(0),D.a.error(u.t0);case 22:case"end":return u.stop()}}),null,null,[[0,19]])},a.renderBack=function(){return console.log("location is ",a.state.location),console.log("props location is ",a.props.location),r.a.createElement(H,null)},a.renderConfirm=function(){var e=a.context.user,t=a.context.log;return t.debug("EditDistrict about to confirm, latitude is "+a.state.location.coordinates.latitude+" and longitude are "+a.state.location.coordinates.longitude),r.a.createElement(x,{location:a.state.location,username:e.login.username,log:t})},a.renderDefault=function(){return r.a.createElement("div",{className:"container-fluid bg-almostWhite full-screen"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,"Enter your new address"))),r.a.createElement("div",{className:"row pb-3"},r.a.createElement("div",{className:"col "},r.a.createElement(m.a,null,r.a.createElement(m.a.Group,{id:"formBasicAddress"},r.a.createElement(m.a.Label,{id:"streetNoLabel",className:"entry-field-label"},"Street Number"),r.a.createElement(m.a.Control,{id:"streetNo",type:"number",value:a.state.location.street.number,onChange:function(e){var t=Object(O.a)({},a.state.location);t.street.number=e.target.value,a.setState({location:t})}}),r.a.createElement(m.a.Label,{className:"entry-field-label"},"Address"),r.a.createElement(m.a.Control,{type:"text",value:a.state.location.street.name,onChange:function(e){var t=Object(O.a)({},a.state.location);t.street.name=e.target.value,a.setState({location:t})}})),r.a.createElement(m.a.Group,{id:"formBasicCity"},r.a.createElement(m.a.Label,{className:"entry-field-label"},"City"),r.a.createElement(m.a.Control,{type:"text",value:a.state.location.city,onChange:function(e){return a.setState({location:Object(O.a)({},a.state.location,{city:e.target.value})})}})),r.a.createElement(m.a.Group,{id:"formBasicPostalcode"},r.a.createElement(m.a.Label,{className:"entry-field-label"},"Postal Code"),r.a.createElement(m.a.Control,{type:"text",value:a.state.location.postcode,onChange:function(e){return a.setState({location:Object(O.a)({},a.state.location,{postcode:e.target.value})})}})),r.a.createElement(m.a.Group,{value:a.state.location.state,className:"right-align-div"},r.a.createElement(I.a,{id:"provinceDropdown",title:"Province/Territory",variant:"secondary"},r.a.createElement(S.a.Item,{id:"Alberta",onClick:function(){a.setState({location:Object(O.a)({},a.state.location,{state:"Alberta"})})}},"Alberta"),r.a.createElement(S.a.Item,{id:"BritishColumbia",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"British Columbia"})})}},"British Columbia"),r.a.createElement(S.a.Item,{id:"Manitoba",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Manitoba"})})}},"Manitoba"),r.a.createElement(S.a.Item,{id:"NewBrunswick",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"New Brunswick"})})}},"New Brunswick"),r.a.createElement(S.a.Item,{id:"NewfoundlandandLabrador",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Newfoundland and Labrador"})})}},"Newfoundland and Labrador"),r.a.createElement(S.a.Item,{id:"NorthwestTerritories",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Northwest Territories"})})}},"Northwest Territories"),r.a.createElement(S.a.Item,{id:"NovaScotia",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Nova Scotia"})})}},"Nova Scotia"),r.a.createElement(S.a.Item,{id:"Nunavut",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Nunavut"})})}},"Nunavut"),r.a.createElement(S.a.Item,{id:"Ontario",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Ontario"})})}},"Ontario"),r.a.createElement(S.a.Item,{id:"PrinceEdwardIsland",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Prince Edward Island"})})}},"Prince Edward Island"),r.a.createElement(S.a.Item,{id:"Quebec",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Quebec"})})}},"Quebec"),r.a.createElement(S.a.Item,{id:"Saskatchewan",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Saskatchewan"})})}},"Saskatchewan"),r.a.createElement(S.a.Item,{id:"Yukon",onClick:function(){return a.setState({location:Object(O.a)({},a.state.location,{state:"Yukon"})})}},"Yukon"))),r.a.createElement(m.a.Group,{controlId:"formSubmit",className:"centre-align-div"},r.a.createElement(u.a,{variant:"secondary w-50 mr-3",type:"button",onClick:function(){a.setState({activeComponentId:2})}},"Home"),r.a.createElement(u.a,{variant:"secondary w-50 ml-3",type:"submit",onClick:function(e){a.handleFormSubmit(e)},disabled:a.checkInvalidInput()},"Next"))))))},a.renderActiveComponent=function(){switch(a.state.activeComponentId){case 2:return a.renderBack();case 1:return a.renderConfirm();case 0:default:return a.renderDefault()}},a.state={location:JSON.parse(JSON.stringify(e.location)),activeComponentId:0},a}return Object(C.a)(t,e),Object(y.a)(t,[{key:"checkInvalidInput",value:function(){return""===this.state.location.street.number||(""===this.state.location.street.name.trim()||(""===this.state.location.city.trim()||(""===this.state.location.postcode.trim()||""===this.state.location.state.trim())))}},{key:"render",value:function(){return this.renderActiveComponent()}}]),t}(n.Component);P.contextType=p;var B=P;var V=function(){return r.a.createElement("div",null,r.a.createElement("i",{className:"fa fa-spinner fa-spin"})," Loading...")};var _=function(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),c=a[0],o=a[1],l=function(e){switch(e){case"Conservative Party of Canada":return"http://www.conservative.ca";case"Green Party of Canada":return"http://greenparty.ca";case"Liberal Party of Canada":return"http://www.liberal.ca";case"New Democratic Party":return"http://www.ndp.ca";case"Bloc Qu\xe9b\xe9cois":return"http://blocquebecois.org";default:return"https://www.elections.ca/content.aspx?section=pol&dir=par&document=index&lang=e"}};return function(){switch(c){case 2:return r.a.createElement(H,null);case 1:return r.a.createElement(T,{log:e.log});case 0:default:return function(){var t=e.candidate;return r.a.createElement("div",{className:"container-fluid full-screen bg-almostWhite"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,t.first_name," ",t.last_name),r.a.createElement("h5",null,t.party_affiliation),r.a.createElement("h5",null,t.district_name))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col centre-align-div"},r.a.createElement("h4",null,r.a.createElement("a",{href:l(t.party_affiliation)},t.party_affiliation)))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col centre-align-div"},r.a.createElement("h4",null,r.a.createElement("a",{href:"https://www.elections.ca/content.aspx?section=pol&dir=par&document=index&lang=e"},"Elections Canada Registered Political Parties")))),r.a.createElement("div",{className:"row p-3"},r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){o(1)}},"View Candidates")),r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){o(2)}},"Home"))))}()}}()},R=a(14);var T=function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(null),d=Object(i.a)(l,2),m=d[0],f=d[1],E=Object(n.useState)(null),b=Object(i.a)(E,2),g=b[0],h=b[1],y=Object(n.useState)(0),w=Object(i.a)(y,2),N=w[0],C=w[1];Object(n.useEffect)((function(){!function(){var t,a,n;s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,null!==m){r.next=3;break}return r.abrupt("return");case 3:if(0!==N){r.next=13;break}return t=m.location.postcode.replace(/\s/g,""),a="/api/v1/candidates/".concat(t),e.log.debug(a),r.next=9,s.a.awrap(v.a.get(a));case 9:n=r.sent,e.log.debug("View Candidates found ",n),o(n.data.candidateList),C(2);case 13:r.next=19;break;case 15:r.prev=15,r.t0=r.catch(0),e.log.error(r.t0),o([]);case 19:case"end":return r.stop()}}),null,null,[[0,15]])}()}),[m]);var k=function(e){switch(e.party_affiliation){case"New Democratic Party":return"ndp";case"Green Party of Canada":return"green";case"Conservative Party of Canada":return"pc";case"Liberal Party of Canada":return"liberal";case"Bloc Qu\ufffdb\ufffdcois":return"bloc";default:return"other"}},j=function(e){return r.a.createElement("div",{key:e.id,className:"col-12 mt-3"},r.a.createElement(R.a,{className:k(e)},r.a.createElement(R.a.Title,null,decodeURI(e.first_name)," ",decodeURI(e.last_name)),r.a.createElement(R.a.Text,null,decodeURI(e.party_affiliation)),r.a.createElement("button",{className:"btn btn-secondary",onClick:function(t){h(e),C(3)}},"View ",e.first_name," ",e.last_name)))},O=function(){switch(N){case 0:return r.a.createElement(V,null);case 1:return r.a.createElement(H,null);case 3:return t=g,r.a.createElement(_,{candidate:t,handleSelectCandidate:h,log:e.log});case 4:return c.map((function(e){return j(e)}));case 2:default:return r.a.createElement("div",{className:"container-fluid bg-almostWhite"},r.a.createElement("div",{className:"row "},c.map((function(t){return e.log.debug(t),j(t)}))),r.a.createElement("div",{className:"row mt-3 pb-3"},r.a.createElement("div",{className:"col text-right"},r.a.createElement(u.a,{variant:"secondary",onClick:function(){C(1)}},"Home"))))}var t};return r.a.createElement(p.Consumer,null,(function(e){var t=e.user;return f(t),O()}))},U=a(28);var A=function(e){return e.model.map((function(t,a){return r.a.createElement(U.a,{key:a,className:"pb-3"},r.a.createElement(m.a.Control,{plaintext:!0,readOnly:!0,className:"bg-white text-right pr-3",defaultValue:t.last_name+", "+t.first_name+" / "+t.party_affiliation}),r.a.createElement(U.a.Append,null,r.a.createElement(U.a.Radio,{name:"votingGroup","aria-label":t.last_name+", "+t.first_name+" / "+t.party_affiliation,onChange:function(){return e.handleFormSelect(t)}})))}))};var Q=function(e){var t=Object(n.useState)(e.candidate),a=Object(i.a)(t,1)[0],c=Object(n.useState)(0),o=Object(i.a)(c,2),l=o[0],s=o[1],d=function(){switch(l){case 1:return r.a.createElement(H,null);case 0:default:return r.a.createElement("div",{className:"container-fluid bg-almostWhite full-screen"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,"You voted for"))),r.a.createElement("div",{className:"row pb-3 text-center"},r.a.createElement("div",{className:"col"},r.a.createElement(R.a,null,r.a.createElement(R.a.Body,null,r.a.createElement(R.a.Title,null,a.first_name," ",a.last_name),r.a.createElement(R.a.Text,null,a.party_affiliation))))),r.a.createElement("div",{className:"row pt-3"},r.a.createElement("div",{className:"col"},r.a.createElement("h2",null,"Thank you! Your vote has been registered."))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col right-align-div"},r.a.createElement(u.a,{variant:"secondary w-50",onClick:function(){s(1)}},"Home"))))}};return r.a.createElement(p.Consumer,null,(function(e){e.user;return d()}))};var z=function(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(e.candidate),s=Object(i.a)(l,1)[0],d=Object(n.useState)(e.voter),m=Object(i.a)(d,1)[0],f=function(t){switch(c){case 1:return r.a.createElement(F,{log:e.log});case 2:return function(t){var a="/api/v1/candidates/".concat(s._id);return e.log.debug("candidate is ",s),e.log.debug(a),v()({method:"put",url:a,data:{voterId:m._id}}).then((function(a){e.log.debug("vote submitted and response is ",a),m.hasvoted="true",t(m)})).catch((function(t){e.log.error(t)})),r.a.createElement(Q,{candidate:s,log:e.log})}(t);case 0:default:return r.a.createElement("div",{className:"container-fluid bg-almostWhite full-screen"},r.a.createElement("div",{className:"row pb-3"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,"You are voting for"))),r.a.createElement("div",{className:"row pb-3 text-center"},r.a.createElement("div",{className:"col"},r.a.createElement(R.a,null,r.a.createElement(R.a.Body,null,r.a.createElement(R.a.Title,null,s.first_name," ",s.last_name),r.a.createElement(R.a.Text,null,s.party_affiliation))))),r.a.createElement("div",{className:"row pt-3"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,"Is this correct?"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){o(1)}},"Edit")),r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){o(2)}},"Confirm"))))}};return r.a.createElement(p.Consumer,null,(function(e){var t=e.handleLogin;return f(t)}))};var F=function(e){var t=Object(n.useState)([]),a=Object(i.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(null),d=Object(i.a)(l,2),m=d[0],f=d[1],E=Object(n.useState)(0),b=Object(i.a)(E,2),g=b[0],h=b[1],y=Object(n.useState)(null),w=Object(i.a)(y,2),N=w[0],C=w[1];Object(n.useEffect)((function(){!function(){var t,a,n;s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,null!==N){r.next=3;break}return r.abrupt("return");case 3:if(0!==g){r.next=14;break}return e.log.debug(N),t=N.location.postcode.replace(/\s/g,""),a="/api/v1/candidates/".concat(t),e.log.debug("Vote loadCandidates with ".concat(a)),r.next=10,s.a.awrap(v.a.get(a));case 10:n=r.sent,e.log.debug("Vote loadCandidates after ",n.data),o(n.data.candidateList),h(2);case 14:r.next=20;break;case 16:r.prev=16,r.t0=r.catch(0),e.log.error(r.t0),o([]);case 20:case"end":return r.stop()}}),null,null,[[0,16]])}()}),[N]);var k=function(t){return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:e.log.debug("Vote, candidate selected, candidate is ",t),f(t);case 2:case"end":return a.stop()}}))},j=function(){switch(g){case 0:return r.a.createElement(V,null);case 1:return r.a.createElement(z,{candidate:m,log:e.log,voter:N});case 3:return r.a.createElement(H,null);case 2:default:return r.a.createElement("div",{className:"container-fluid bg-almostWhite full-screen"},r.a.createElement("div",{className:"row pt-3"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",null,"Vote in District ",N.location.district))),r.a.createElement("div",{className:"row pt-3 pb-3"},r.a.createElement("div",{className:"col"},r.a.createElement(A,{model:c,handleFormSelect:k}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",type:"submit",onClick:function(){h(3)}},"Home")),r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",type:"submit",onClick:function(){h(1)},disabled:null===m},"Vote"))))}};return r.a.createElement(p.Consumer,null,(function(e){var t=e.user;return C(t),j()}))};j.a.accessToken="pk.eyJ1IjoiZXNjaGVyZmFuIiwiYSI6ImNrNTE2Nms3ZzBzamszbHRleTBxaWcybzYifQ.lhHHhIhbXLQI7QZIfzRVpQ";var G=function(e){function t(){var e,a;Object(h.a)(this,t);for(var n=arguments.length,c=new Array(n),o=0;o<n;o++)c[o]=arguments[o];return(a=Object(w.a)(this,(e=Object(N.a)(t)).call.apply(e,[this].concat(c)))).state={activeComponentId:0,map:null},a.district="",a.renderDefault=function(){var e=a.context.user;return r.a.createElement("div",{className:"container-fluid full-screen"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-8 col-sm-9 mt-3 ml-3 bg-white text-center pt-2 mapFormWidget"},"Your district is ",e.location.district),r.a.createElement("div",{className:"col-3 col-sm-2 mt-3"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){a.setState({activeComponentId:2})}},"Edit"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{ref:function(e){return a.mapContainer=e},className:"col mapContainer"})),r.a.createElement("div",{className:"row pb-3"},r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){a.setState({activeComponentId:3})}},"View Candidates")),r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){a.setState({activeComponentId:4})},disabled:"true"===e.hasvoted},"Vote"))))},a.renderEditDistrict=function(){var e=a.context.user;return r.a.createElement(B,{location:e.location})},a.renderViewCandidates=function(){return r.a.createElement(T,{log:a.context.log})},a.renderVote=function(){return r.a.createElement(F,{log:a.context.log})},a.renderActiveComponent=function(){switch(a.state.activeComponentId){case 4:return a.renderVote();case 3:return a.renderViewCandidates();case 2:return a.renderEditDistrict();case 0:default:return a.renderDefault()}},a}return Object(C.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){if(0===this.state.activeComponentId){var e=this.context.user,t=this.context.log,a=e.location.coordinates.latitude,n=e.location.coordinates.longitude;t.debug("Landing componentDidMount voter location is ",e.location);var r=new j.a.Map({container:this.mapContainer,style:"mapbox://styles/mapbox/streets-v11",center:[n,a],zoom:12}),c=e.location.district.replace(/\s/g,"");r.on("load",(function(){void 0===r.getLayer(c)&&r.addLayer({id:c,type:"fill",source:{type:"geojson",data:{type:"Feature",geometry:e.location.districtBoundaries}},layout:{},paint:{"fill-color":"#D3D3D3","fill-opacity":.8}})})),this.district=e.location.district,this.setState({map:r})}}},{key:"componentDidUpdate",value:function(){this.updateMap()}},{key:"updateMap",value:function(){var e=this,t=this.context.user;if(null!==this.state.map&&this.state.map.isSourceLoaded){var a=t.location.coordinates.latitude,n=t.location.coordinates.longitude;if(this.state.map.setCenter([n,a]),this.context.log.debug("Landing componentDidUpdate map is ",this.state.map),this.districtChanged(t.location.district)){var r=t.location.district.replace(/\s/g,"");this.state.map.on("data",(function(){void 0===e.state.map.getLayer(r)&&e.state.map.addLayer({id:r,type:"fill",source:{type:"geojson",data:{type:"Feature",geometry:t.location.districtBoundaries}},layout:{},paint:{"fill-color":"#D3D3D3","fill-opacity":.8}}),e.district=t.location.district}))}}}},{key:"districtChanged",value:function(e){return this.district!==e}},{key:"render",value:function(){return this.renderActiveComponent()}}]),t}(n.Component);G.contextType=p;var H=G,Y=a(44),M=a.n(Y),W=function(e){function t(){return Object(h.a)(this,t),Object(w.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(C.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){var e=this.props.features;if(0===e.length)return r.a.createElement("div",null);var t=e[0];return r.a.createElement("div",null,r.a.createElement("div",{className:"bg-white"},r.a.createElement("div",{key:t.layer.metadata.votingDistrict},r.a.createElement("strong",null,t.layer.metadata.votingDistrict),r.a.createElement("div",null,t.layer.metadata.votingSeat))),r.a.createElement("span",{className:"flex-child color-white triangle triangle--d"}))}}]),t}(r.a.Component);j.a.accessToken="pk.eyJ1IjoiZXNjaGVyZmFuIiwiYSI6ImNrNTE2Nms3ZzBzamszbHRleTBxaWcybzYifQ.lhHHhIhbXLQI7QZIfzRVpQ";var Z="#D3D3D3",J=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(w.a)(this,Object(N.a)(t).call(this,e))).state={map:null,isLoading:!0},a.renderSimulation=function(){a.setState({isLoading:!0}),v()({method:"put",url:"/api/v1/simulation/run"}).then((function(e){for(var t=e.data,n=0;n<t.length;n++){var r=t[n],c=a.getDistrictLayerId(r),o=a.getPartyColour(r.seat);void 0!==a.state.map.getLayer(c)&&(a.state.map.getLayer(c).metadata.votingSeat=r.seat,a.state.map.setPaintProperty(c,"fill-color",o))}a.setState({isLoading:!1})})).catch((function(e){a.props.log.error("Error while running simulation"),a.props.log.error(e),a.setState({isLoading:!1})}))},a.resetSimulation=function(){a.setState({isLoading:!0}),v()({method:"put",url:"/api/v1/simulation/reset"}).then((function(e){for(var t=e.data,n=0;n<t.length;n++){var r=t[n],c=a.getDistrictLayerId(r);void 0!==a.state.map.getLayer(c)&&(a.state.map.getLayer(c).metadata.votingSeat="Awaiting vote",a.state.map.setPaintProperty(c,"fill-color",Z))}a.setState({isLoading:!1})})).catch((function(e){a.props.log.error("Error while resetting simulation"),a.props.log.error(e),a.setState({isLoading:!1})}))},a}return Object(C.a)(t,e),Object(y.a)(t,[{key:"setTooltip",value:function(e){o.a.render(r.a.createElement(W,{features:e}),this.tooltipContainer)}},{key:"componentDidMount",value:function(){var e=this;try{var t=new j.a.Map({container:this.mapContainer,style:"mapbox://styles/mapbox/dark-v10",center:[-75.7,45.416667],zoom:4});this.tooltipContainer=document.createElement("div");var a=new j.a.Marker(this.tooltipContainer,{offset:[-25,0]});a.setLngLat([0,0]),a.addTo(t),v()({method:"get",url:"/api/v1/districts"}).then((function(n){for(var r=n.data,c=0;c<r.length;c++){var o=r[c];e.addLayer(o,t)}t.on("mousemove",(function(n){var r=t.queryRenderedFeatures(n.point);a.setLngLat(n.lngLat);var c=r.filter((function(e){return null!=e.layer.metadata&&void 0!==e.layer.metadata.votingDistrict}));t.getCanvas().style.cursor=c.length>0?"pointer":"",e.setTooltip(c)})),t.setCenter([-97.139313,49.900501]),e.setState({isLoading:!1})})).catch((function(t){e.props.log.error("Simulation componentDidMount. Error while retrieving districts for simulation"),e.props.log.error(t),e.setState({isLoading:!1})})),this.setState({map:t})}catch(n){this.props.log.error("Error while creating blank map for simulation"),this.props.log.error(n)}}},{key:"getPartyColour",value:function(e){switch(e){case"Independent":return"#FF6EC7";case"Conservative Party of Canada":return"#244982";case"Green Party of Canada":return"#4e9a2f";case"Liberal Party of Canada":return"#cd2003";case"New Democratic Party":return"#ec8200";case"Bloc Qu\xe9b\xe9cois":case"Bloc Qu\ufffdb\ufffdcois":return"#143d73";default:return this.props.log.trace("Seat won by ",e),"#CCFF00"}}},{key:"getDistrictLayerId",value:function(e){return e.district_name.replace(/\s/g,"")}},{key:"addLayer",value:function(e,t){var a=this;t.on("data",(function(){var n=a.getDistrictLayerId(e),r=null===e.seat?"Awaiting vote":e.seat,c=null===e.seat?Z:a.getPartyColour(e.seat);void 0===t.getLayer(n)&&t.addLayer({id:n,type:"fill",source:{type:"geojson",data:{type:"Feature",geometry:e.location.districtBoundaries}},metadata:{votingDistrict:e.district_name,votingSeat:r},layout:{},paint:{"fill-color":c,"fill-opacity":.8}})}))}},{key:"render",value:function(){var e=this,t=this.state.isLoading?" bold ":" hide";return r.a.createElement("div",{className:"container-fluid full-screen"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{ref:function(t){return e.mapContainer=t},className:"col mapContainer"})),r.a.createElement("div",{className:"row d-flex justify-content-center"+t},r.a.createElement("i",{className:"fa fa-spinner fa-spin"}),r.a.createElement("span",{className:"w-80 pl-2 text-center"},"Loading...")),r.a.createElement("div",{className:"row pb-3"},r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){e.resetSimulation()},disabled:this.state.isLoading},"Reset Vote")),r.a.createElement("div",{className:"col"},r.a.createElement(u.a,{variant:"secondary w-100",onClick:function(){e.renderSimulation()},disabled:this.state.isLoading},"Simulate Vote"))))}}]),t}(n.Component);J.contextType=p;var X=J;D.a.setLevel("debug"),D.a.trace("App mapbox access token is ","pk.eyJ1IjoiZXNjaGVyZmFuIiwiYSI6ImNrNTE2Nms3ZzBzamszbHRleTBxaWcybzYifQ.lhHHhIhbXLQI7QZIfzRVpQ");M.a.apply(D.a,{format:function(e){return{msg:e.message,level:"debug",stacktrace:e.stacktrace}},url:"/internal/v1/logger"});var q=function(){var e=Object(n.useState)(null),t=Object(i.a)(e,2),a=t[0],c=t[1],o=null;return o=null===a?r.a.createElement(g,{log:D.a}):!0===a.isAdmin?r.a.createElement(X,{log:D.a}):r.a.createElement(H,null),r.a.createElement(p.Provider,{value:{user:a,handleLogin:function(e){if(null!==e){if(!e.isAdmin){var t={name:e.name,district:e.location.district,street:e.location.street,city:e.location.city,postcode:e.location.postcode,username:e.login.username};D.a.info("App Context ",JSON.stringify(t))}c(e)}},log:D.a}},o)};a(75),a(76);o.a.render(r.a.createElement(q,null),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.ae4d61db.chunk.js.map